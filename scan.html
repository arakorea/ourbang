<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ourbang — Scan</title>
  <meta name="description" content="ourbang Scan — LiDAR 또는 카메라로 공간을 스캔하는 방법을 안내합니다." />

  <meta property="og:title" content="ourbang — Scan" />
  <meta property="og:description" content="Scan a space with LiDAR or Camera" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/images/og/og-cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon" href="assets/images/brand/favicon.png" />
  <link rel="stylesheet" href="assets/css/site.css?v=22" />

  <style>
    /* Scan page-specific layout only (nav styling stays in assets/css/site.css) */
    .hero{padding:44px 0 18px}
    h1{font-size:44px; margin:12px 0}
    .lead{color:var(--muted); max-width:720px; line-height:1.7}

    .grid{display:grid; grid-template-columns:1fr 1fr; gap:18px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .panel{
      position:relative;
      min-height:360px;
      border-radius:var(--radius2);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:var(--panel);
      box-shadow:var(--shadow);
    }
    .panelBg{
      position:absolute; inset:0;
      background-image:
        linear-gradient(180deg, rgba(7,9,15,.25), rgba(7,9,15,.75)),
        url("assets/images/preview/scan-shot.jpg");
      background-size:cover;
      background-position:center;
    }
    .panelInner{position:relative; padding:18px; display:flex; flex-direction:column; gap:12px}
    .step{border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:14px; background:rgba(0,0,0,.22)}
    .step h3{margin:0 0 6px; font-size:16px}
    .step p{margin:0; color:var(--muted); font-size:13px; line-height:1.6}

    /* Video stage */
    .videoStage{
      position: relative;
      width: 100%;
      max-width: 1100px;
      margin: 26px auto 10px;
      aspect-ratio: 16 / 9;
      border-radius: var(--radius2);
      overflow: hidden;
      background: #000;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
    }
    .videoStage video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: contain;
      background:#000;
    }

    /* Visible artwork boxes (clickable) */
    .hotspot{
      position:absolute;
      z-index: 5;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:8px;
      padding:10px 10px 8px;
      border-radius:16px;
      border:1px solid rgba(124,198,255,.55);
      background: linear-gradient(180deg, rgba(7,9,15,.20), rgba(7,9,15,.55));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      text-align:left;
    }
    .hotspot:hover{border-color: rgba(124,198,255,.78)}
    .hotspot:active{transform: translateY(1px)}
    .hotspotTop{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .hotspotTag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      font-size:12px;
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }
    .hotspotTitle{font-size:13px; line-height:1.2; margin:0; color: rgba(255,255,255,.92)}
    .hotspotMeta{font-size:12px; color: rgba(255,255,255,.70); margin:0}
    .hotspotBuy{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height:30px;
      padding:0 10px;
      border-radius:999px;
      border:1px solid rgba(124,198,255,.30);
      background: rgba(124,198,255,.14);
      color: rgba(255,255,255,.92);
      font-size:12px;
      text-decoration:none;
      width:max-content;
    }

    /* Navigation controls under video */
    .vidNav{
      max-width: 1100px;
      margin: 10px auto 0;
      padding: 0 6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .vidNavLeft{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .ppBtn{
      width:42px;
      height:42px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      -webkit-tap-highlight-color: transparent;
    }
    .ppBtn:hover{background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.20)}
    .vidDots{display:flex; gap:8px; flex-wrap:wrap}
    .dotBtn{
      width:34px; height:34px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.82);
      cursor:pointer;
      font-size:13px;
      -webkit-tap-highlight-color: transparent;
    }
    .dotBtn[aria-current="true"]{
      border-color: rgba(124,198,255,.60);
      background: rgba(124,198,255,.14);
      color: rgba(255,255,255,.92);
    }
    .vidHint{color: rgba(255,255,255,.60); font-size:12px; line-height:1.5}
    @media(max-width: 980px){
      .vidNav{padding: 0 14px}
    }

    /* Tap-to-start overlay (autoplay blocked) */
    .tapStart{
      position:absolute;
      z-index:7;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      display:none;
      align-items:center;
      justify-content:center;
      min-width: 180px;
      height: 56px;
      padding: 0 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.42);
      color: rgba(255,255,255,.92);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      font-size: 15px;
      letter-spacing:.2px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .tapStart:hover{background: rgba(0,0,0,.52)}
    .tapStart:active{transform:translate(-50%,-50%) translateY(1px)}

    /* Modal */
    .modalBack{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .modalBack.open{display:flex}
    .modal{
      width:min(920px,92vw);
      border-radius:28px;
      background:linear-gradient(180deg, rgba(20,24,32,.95), rgba(10,12,18,.98));
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 30px 120px rgba(0,0,0,.6);
    }
    .modalTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 20px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .modalTop h3{margin:0;font-size:18px}
    .modalClose{
      background:none;
      border:none;
      color:var(--muted);
      font-size:14px;
      cursor:pointer;
    }
    .modalBody{padding:20px}
    .modalGrid{display:grid; grid-template-columns:1.1fr .9fr; gap:20px}
    @media(max-width:900px){ .modalGrid{grid-template-columns:1fr} }
    .modalImg{width:100%; border-radius:18px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03)}
  </style>
</head>
<body>
<header class="topbar">
  <div class="wrap">
    <div class="nav">
      <a class="brand" href="index.html">
        <div class="name">
          <strong>ourbang</strong>
          <span class="brand-spacer" aria-hidden="true"></span>
        </div>
      </a>

      <nav class="menu" aria-label="Primary">
        <a href="explore.html">Explore</a>
        <a href="scan.html" class="is-active" aria-current="page">Scan</a>
        <a href="mirror.html">Mirror</a>
        <a href="vision.html">Vision</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </div>
</header>

<main>
  <section class="hero">
    <div class="wrap">
      <h1>공간을 스캔하는 방법</h1>
      <p class="lead">
        ourbang은 LiDAR 또는 카메라 기반으로 공간을 수집합니다.
        촬영 난이도를 낮추고, 결과물의 일관성을 유지하는 것이 목표입니다.
      </p>

      <div class="grid">
        <div class="panel">
          <div class="panelBg"></div>
        </div>

        <div class="panel">
          <div class="panelInner">
            <div class="step">
              <h3>1. 공간 준비</h3>
              <p>조명을 켜고, 이동 가능한 물체를 최소화합니다.</p>
            </div>
            <div class="step">
              <h3>2. 촬영 / 스캔</h3>
              <p>LiDAR 또는 카메라로 천천히 공간을 이동하며 촬영합니다.</p>
            </div>
            <div class="step">
              <h3>3. 업로드</h3>
              <p>촬영 데이터를 업로드하면 ourbang이 디지털 공간으로 변환합니다.</p>
            </div>
            <div class="step">
              <h3>4. 검수 & 공개</h3>
              <p>결과를 확인하고 탐색 가능한 링크로 공유합니다.</p>
            </div>
          </div>
        </div>
      </div>

      <section class="section" id="showroom" aria-label="Showroom demo" style="margin-top:26px">
        <div class="galleryHead">
          <div>
            <h2 class="galleryTitle">Scan → Showroom Demo</h2>
            <p class="sub">
              영상은 천천히 자동 재생됩니다. 아래 네비게이션(⏸︎/▶︎, 작품 번호)로 정지/재생 및 작품 구간 이동이 가능합니다.
              박스(작품 정보)를 누르면 상세(모달)과 구매 페이지(데모)로 연결됩니다.
            </p>
          </div>
        </div>

        <div class="videoStage" id="videoStage">
          <video id="showroomVideo" preload="metadata" muted playsinline webkit-playsinline loop>
            <source src="assets/videos/ourbanggallery.mp4" type="video/mp4" />
          </video>
          <button class="tapStart" id="tapStart" type="button" aria-label="Tap to start">Tap to Start</button>
          <!-- hotspots injected by JS -->
        </div>

        <div class="vidNav" aria-label="Video navigation">
          <div class="vidNavLeft">
            <button class="ppBtn" id="ppBtn" type="button" aria-label="Play / Pause">⏸︎</button>
            <div class="vidDots" id="vidDots" aria-label="Artwork navigation"></div>
          </div>
          <div class="vidHint">Tip: 작품 번호를 누르면 해당 구간으로 이동 후 자동 정지됩니다.</div>
        </div>

        <p class="note" style="margin-top:12px">
          External checkout · Pilot demonstration (실제 결제는 진행되지 않습니다)
        </p>
      </section>
    </div>
  </section>

  <!-- Artwork modal -->
  <div class="modalBack" id="artModalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="artModalTitle">
      <div class="modalTop">
        <div>
          <h3 id="artModalTitle">Artwork</h3>
          <div class="sub" id="artModalMeta"></div>
        </div>
        <button class="modalClose" id="artModalClose" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div class="modalGrid">
          <div>
            <img class="modalImg" id="artModalImg" alt="Artwork image" src="" />
          </div>
          <div>
            <p class="sub" id="artModalDesc" style="margin-top:0"></p>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px">
              <a class="btn primary" id="artModalBuy" href="purchase.html?id=1">View &amp; Purchase</a>
              <a class="btn" href="#showroom">Back to video</a>
            </div>

            <p class="note" style="margin-top:12px">
              ourbang은 결제를 직접 처리하지 않습니다. 본 버튼은 “결제 흐름”을 보여주는 데모입니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="foot">
  <div class="wrap">
    <div class="footRow">
      <div>© <span id="y"></span> ourbang. All rights reserved.</div>
      <div style="display:flex; gap:14px; flex-wrap:wrap">
        <a class="mutelink" href="index.html">Home</a>
        <a class="mutelink" href="explore.html">Explore</a>
        <a class="mutelink" href="scan.html">Scan</a>
        <a class="mutelink" href="vision.html">Vision</a>
      </div>
    </div>
  </div>
</footer>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();
</script>

<script>
(function(){
  const video = document.getElementById("showroomVideo");
  const stage = document.getElementById("videoStage");

  // --- Speed control (slower than before) ---
  // 0.12 = 12% speed (feels slow on mobile too). Tune here if needed.
  const PLAYBACK_RATE = 0.12;

  // --- Works / purchase link ---
  const ARTIST = "Angel's Angle";
  const PRICE  = "$400,000";
  const works = {
    1: { title: "Artwork 1", img: "assets/images/artworks/1.jpg" },
    2: { title: "Artwork 2", img: "assets/images/artworks/2.jpg" },
    3: { title: "Artwork 3", img: "assets/images/artworks/3.jpg" },
    4: { title: "Artwork 4", img: "assets/images/artworks/4.jpg" },
    5: { title: "Artwork 5", img: "assets/images/artworks/5.jpg" },
    6: { title: "Artwork 6", img: "assets/images/artworks/6.jpg" },
    7: { title: "Artwork 7", img: "assets/images/artworks/7.jpg" },
  };

  // Hotspot config: normalized 0..1 relative to stage
  const hotspots = [
    {id:1, label:"01", start:0.0, end:1.2, x:0.05, y:0.08, w:0.24, h:0.26},
    {id:2, label:"02", start:1.0, end:3.2, x:0.14, y:0.18, w:0.22, h:0.30},
    {id:3, label:"03", start:1.0, end:3.2, x:0.36, y:0.18, w:0.26, h:0.30},
    {id:4, label:"04", start:1.0, end:3.2, x:0.64, y:0.18, w:0.22, h:0.30},
    {id:5, label:"05", start:0.0, end:6.0, x:0.78, y:0.12, w:0.22, h:0.36},
    {id:6, label:"06", start:2.2, end:4.8, x:0.02, y:0.30, w:0.18, h:0.24},
    {id:7, label:"07", start:3.6, end:5.8, x:0.88, y:0.22, w:0.12, h:0.26},
  ];

  // --- Modal ---
  const back = document.getElementById("artModalBack");
  const closeBtn = document.getElementById("artModalClose");
  const titleEl = document.getElementById("artModalTitle");
  const metaEl  = document.getElementById("artModalMeta");
  const descEl  = document.getElementById("artModalDesc");
  const imgEl   = document.getElementById("artModalImg");
  const buyEl   = document.getElementById("artModalBuy");

  function openModal(id){
    const w = works[id];
    if(!w) return;
    titleEl.textContent = w.title;
    metaEl.textContent  = ARTIST + " · " + PRICE;
    descEl.textContent  = "Artist: " + ARTIST + " · Price: " + PRICE;
    imgEl.src = w.img;
    buyEl.href = "purchase.html?id=" + encodeURIComponent(id);
    back.classList.add("open");
    back.setAttribute("aria-hidden","false");
  }
  function closeModal(){
    back.classList.remove("open");
    back.setAttribute("aria-hidden","true");
  }
  closeBtn.addEventListener("click", closeModal);
  back.addEventListener("click", (e)=>{ if(e.target === back) closeModal(); });
  document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

  // --- Create visible boxes ---
  const hs = hotspots.map(cfg=>{
    const el = document.createElement("button");
    el.type = "button";
    el.className = "hotspot";
    el.setAttribute("aria-label", "Open artwork " + cfg.label);
    el.innerHTML = `
      <div class="hotspotTop">
        <div class="hotspotTag">Artwork ${cfg.label}</div>
      </div>
      <div>
        <p class="hotspotTitle">${works[cfg.id]?.title || ("Artwork " + cfg.label)}</p>
        <p class="hotspotMeta">${ARTIST} · ${PRICE}</p>
      </div>
      <a class="hotspotBuy" href="purchase.html?id=${encodeURIComponent(cfg.id)}">View & Purchase</a>
    `;
    // Button click opens modal (detail)
    el.addEventListener("click", (ev)=>{
      // If user tapped the inner link, allow navigation.
      const a = ev.target && ev.target.closest ? ev.target.closest("a") : null;
      if(a) return;
      openModal(cfg.id);
      // pause at artwork moment for reading
      userPaused = true;
      video.pause();
      setPP();
    });
    stage.appendChild(el);
    return {cfg, el};
  });

  function layout(){
    const rect = stage.getBoundingClientRect();
    const W = rect.width, H = rect.height;
    const t = video.currentTime || 0;

    // highlight current dot if in any range
    let currentId = null;

    hs.forEach(({cfg, el})=>{
      const on = (t >= cfg.start && t <= cfg.end);
      el.hidden = !on;
      if(on) currentId = cfg.id;
      if(!on) return;
      el.style.left   = (cfg.x * W) + "px";
      el.style.top    = (cfg.y * H) + "px";
      el.style.width  = (cfg.w * W) + "px";
      el.style.height = (cfg.h * H) + "px";
    });

    // dots state
    document.querySelectorAll(".dotBtn").forEach(btn=>{
      const id = parseInt(btn.dataset.id || "0", 10);
      btn.setAttribute("aria-current", (id === currentId) ? "true" : "false");
    });
  }

  // --- Play/Pause + dot navigation (visible) ---
  const ppBtn = document.getElementById("ppBtn");
  const dotsWrap = document.getElementById("vidDots");

  let userPaused = false;

  function setPP(){
    if(!ppBtn) return;
    ppBtn.textContent = video.paused ? "▶︎" : "⏸︎";
    ppBtn.setAttribute("aria-label", video.paused ? "Play" : "Pause");
  }

  async function safePlay(){
    // autoplay policies
    video.muted = true;
    video.setAttribute("muted","");
    video.playsInline = true;
    video.setAttribute("playsinline","");
    video.setAttribute("webkit-playsinline","");
    video.playbackRate = PLAYBACK_RATE;

    const tap = document.getElementById("tapStart");
    try{
      if(video.readyState < 2){ video.load(); }
      await video.play();
      if(tap) tap.style.display = "none";
    }catch(err){
      // blocked -> show tap-to-start
      if(tap) tap.style.display = "inline-flex";
    }
    setPP();
  }

  async function togglePlayPause(){
    if(video.paused){
      userPaused = false;
      await safePlay();
    }else{
      userPaused = true;
      video.pause();
    }
    setPP();
    layout();
  }

  if(ppBtn){
    ppBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      e.stopPropagation();
      togglePlayPause();
    });
  }

  // Dots (jump to artwork start, then pause so box is readable/clickable)
  hotspots.forEach(cfg=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "dotBtn";
    b.textContent = cfg.label;
    b.dataset.id = String(cfg.id);
    b.setAttribute("aria-label", "Go to artwork " + cfg.label);
    b.addEventListener("click", (e)=>{
      e.preventDefault();
      e.stopPropagation();
      try{
        video.currentTime = Math.max(0, cfg.start + 0.01);
      }catch(_){}
      userPaused = true;
      video.pause();
      setPP();
      layout();
    });
    dotsWrap.appendChild(b);
  });

  // Tap-to-start overlay
  const tapStart = document.getElementById("tapStart");
  if(tapStart){
    tapStart.addEventListener("click", async (e)=>{
      e.preventDefault();
      e.stopPropagation();
      userPaused = false;
      await safePlay();
      layout();
    });
  }

  // Autoplay attempt on load (muted)
  window.addEventListener("load", ()=>{
    // start slow
    video.playbackRate = PLAYBACK_RATE;
    // try autoplay
    if(!userPaused) safePlay().then(()=> layout());
  });

  // Keep boxes updated
  video.addEventListener("timeupdate", layout);
  video.addEventListener("pause", layout);
  video.addEventListener("seeked", layout);
  video.addEventListener("loadedmetadata", ()=>{
    video.playbackRate = PLAYBACK_RATE;
    layout();
    setPP();
  });
  video.addEventListener("play", ()=>{
    video.playbackRate = PLAYBACK_RATE;
    setPP();
  });
  window.addEventListener("resize", layout);

  // Ensure layout runs even when timeupdate is sparse (mobile + low playbackRate)
  setInterval(layout, 200);

})();
</script>
</body>
</html>
